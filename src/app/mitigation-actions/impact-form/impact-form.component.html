<div class="container">
  <mat-card-content>
    <form *ngIf="newFormData | async" [formGroup]="form" (ngSubmit)="submitForm()">
      <div class="report-error" [hidden]="!error || isLoading || !errorComponent.showErrors" translate>
        <span translate>errorLabel.errorSubmittingForm</span>
        <br />
        <app-error-reporting #errorComponent></app-error-reporting>
      </div>
      <br />
      <div fxLayout="column">
        <div *ngFor="let formElement of getFormKeys(); let i = index">
          <div *ngIf="i > 0">
            <br />
            <mat-divider></mat-divider>
            <br />
          </div>
          <mat-vertical-stepper [formArrayName]="formElement" linear #stepper>
            <mat-step formGroupName="0" [stepControl]="getFormObject(formElement)?.get([0])">
              <ng-template matStepLabel>
                <span translate>specificLabel.monitoringDetail</span>
              </ng-template>

              <h3>
                <span translate>info.code</span>:<span>{{ mitigationAction?.id }}</span>
              </h3>

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.responsibleInstitution</mat-label>
                <input matInput formControlName="responsibleInstitutionCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.indicatorDescription</mat-label>
                <input matInput formControlName="indicatorDescriptionCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>
              <br />

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.indicatorUnit</mat-label>
                <input matInput formControlName="indicatorUnitCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>
              <br />

              <div fxLayout="row" fxLayoutAlign=" center">
                <mat-form-field class="field-ppcn">
                  <mat-label translate>mitigationAction.methodologicalDetailIndicator</mat-label>
                  <input matInput formControlName="methodologicalDetailIndicatorCtrl" />
                  <mat-error translate>errorLabel.fieldRequired</mat-error>
                </mat-form-field>
                <input type="file" name="filename" />
                <br />
              </div>

              <br />

              <span translate>mitigationAction.indicatorReportingPeriodicity</span><br /><br />
              <mat-radio-group
                #indicatorReportingPeriodicity="matRadioGroup"
                formControlName="indicatorReportingPeriodicityCtrl"
                class="custom-radio-group"
              >
                <mat-radio-button [style.margin.px]="5" value="YEARLY">
                  <label translate>general.yearly</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="BIANNUAL">
                  <label translate>general.biannual</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="QUARTERLY">
                  <label translate>general.quarterly</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="OTHER">
                  <label translate>general.other</label>
                </mat-radio-button>
              </mat-radio-group>
              <br />

              <div *ngIf="indicatorReportingPeriodicity.value === 'OTHER'">
                <mat-form-field class="field-ppcn">
                  <mat-label translate>general.other</mat-label>
                  <input matInput formControlName="indicatorReportingPeriodicityOtherCtrl" />
                  <mat-error translate>errorLabel.fieldRequired</mat-error>
                </mat-form-field>
                <br />
              </div>

              <div fxLayout="row" fxLayoutAlign=" center">
                <mat-form-field class="field-ppcn">
                  <mat-label translate>mitigationAction.timeSeriesAvailable</mat-label>
                  <input
                    matInput
                    [placeholder]="'Choose a date' | translate"
                    [matDatepicker]="timeSeriesAvailableCtrl"
                    formControlName="timeSeriesAvailableStartCtrl"
                  />

                  <mat-datepicker-toggle matSuffix [for]="timeSeriesAvailableCtrl"></mat-datepicker-toggle>
                  <mat-datepicker #timeSeriesAvailableCtrl startView="year" [startAt]="startDate"></mat-datepicker>

                  <mat-error translate>errorLabel.fieldRequired</mat-error>
                </mat-form-field>

                <mat-form-field class="field-ppcn">
                  <mat-label translate>general.until</mat-label>
                  <input
                    matInput
                    [placeholder]="'Choose a date' | translate"
                    [matDatepicker]="timeSeriesAvailableEndCtrl"
                    formControlName="timeSeriesAvailableEndCtrl"
                  />

                  <mat-datepicker-toggle matSuffix [for]="timeSeriesAvailableEndCtrl"></mat-datepicker-toggle>
                  <mat-datepicker #timeSeriesAvailableEndCtrl startView="year" [startAt]="startDate"></mat-datepicker>

                  <mat-error translate>errorLabel.fieldRequired</mat-error>
                </mat-form-field>
              </div>
              <br />

              <span translate>mitigationAction.geographicCoverage</span><br /><br />
              <mat-radio-group
                #geographicCoverage="matRadioGroup"
                formControlName="geographicCoverageCtrl"
                class="custom-radio-group"
              >
                <mat-radio-button [style.margin.px]="5" value="NATIONAL">
                  <label translate>Nacional</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="REGIONAL">
                  <label translate>Regional</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="PROVINCIAL">
                  <label translate>Provincial</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="CANTONAL">
                  <label translate>Cantonal</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="OTHER">
                  <label translate>Otro</label>
                </mat-radio-button>
              </mat-radio-group>
              <br />

              <div *ngIf="geographicCoverage.value === 'OTHER'">
                <mat-form-field class="field-ppcn">
                  <mat-label translate>general.other</mat-label>
                  <input matInput formControlName="geographicCoverageOtherCtrl" />
                  <mat-error translate>errorLabel.fieldRequired</mat-error>
                </mat-form-field>
                <br />
              </div>

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.disintegration</mat-label>
                <input matInput formControlName="disintegrationCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.dataSource</mat-label>
                <input matInput formControlName="dataSourceCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <div fxLayout="row" fxLayoutAlign=" center">
                <mat-form-field class="field-ppcn">
                  <mat-label translate>mitigationAction.howSustainabilityIndicator</mat-label>
                  <input matInput formControlName="howSustainabilityIndicatorCtrl" />
                  <mat-error translate>errorLabel.fieldRequired</mat-error>
                </mat-form-field>
                <input type="file" name="filename" />
                <br />
              </div>

              <span translate>mitigationAction.sinameccClassifiers</span><br /><br />
              <mat-radio-group formControlName="sinameccClassifiersCtrl" class="custom-radio-group">
                <mat-radio-button [style.margin.px]="5" value="1">
                  <label translate>Acción Climática</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="2">
                  <label translate>Modelación</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="3">
                  <label translate>INGEI</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="4">
                  <label translate>Reportes</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="4">
                  <label translate>Finanzas Climaticas</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="4">
                  <label translate>Impactos</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="4">
                  <label translate>Otro</label>
                </mat-radio-button>
              </mat-radio-group>
              <br />

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.observationsComments</mat-label>
                <input matInput formControlName="observationsCommentsCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <div fxLayout="row" fxLayoutAlign=" center">
                <mat-form-field class="field-ppcn">
                  <mat-label translate>mitigationAction.additionalInformation</mat-label>
                  <input matInput formControlName="additionalInformationCtrl" />
                  <mat-error translate>errorLabel.fieldRequired</mat-error>
                </mat-form-field>
                <input type="file" accept=".rar,application/pdf,.zip" name="filename" />
                <br />
              </div>

              <br />
              <br />

              <!--<app-generic-button mat-raised-button (click)="addIndicatorItem()" name="mitigationAction.newIndicator" type="button"
              *ngIf="activityFormGroup?.controls.length <= 10">
          </app-generic-button>
          -->

              <div class="box-button">
                <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
                </app-generic-button-secondary>
                <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
              </div>
            </mat-step>

            <mat-step formGroupName="1" [stepControl]="getFormObject(formElement)?.get([1])">
              <ng-template matStepLabel>
                <span translate>mitigationAction.indicatorDataSource</span>
              </ng-template>

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.responsibleInstitution</mat-label>
                <input matInput formControlName="responsibleInstitutionCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <span translate>mitigationAction.sourceType</span><br /><br />
              <mat-radio-group #sourceType="matRadioGroup" formControlName="sourceTypeCtrl" class="custom-radio-group">
                <mat-radio-button [style.margin.px]="5" [value]="1">
                  <label translate>Censos</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" [value]="2">
                  <label translate>Encuesta por muestreo</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" [value]="3">
                  <label translate>Combinación de censo y muestreo</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" [value]="4">
                  <label translate>Sondeos de opinión</label>
                </mat-radio-button>

                <mat-radio-button [style.margin.px]="5" [value]="5">
                  <label translate>Registro administrativo</label>
                </mat-radio-button>

                <mat-radio-button [style.margin.px]="5" [value]="6">
                  <label translate> Sistema de Monitoreo</label>
                </mat-radio-button>

                <mat-radio-button [style.margin.px]="5" [value]="7">
                  <label translate>Estimación directa</label>
                </mat-radio-button>

                <mat-radio-button [style.margin.px]="5" [value]="8">
                  <label translate>general.other</label>
                </mat-radio-button>
              </mat-radio-group>
              <br />

              <div *ngIf="sourceType.value === 8">
                <mat-form-field class="field-ppcn">
                  <mat-label translate>general.other</mat-label>
                  <input matInput formControlName="sourceTypeOtherCtrl" />
                  <mat-error translate>errorLabel.fieldRequired</mat-error>
                </mat-form-field>
                <br />
              </div>

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.statisticalOperationName</mat-label>
                <input matInput formControlName="statisticalOperationNameCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <br />

              <div class="box-button">
                <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
                </app-generic-button-secondary>
                <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
              </div>
            </mat-step>

            <mat-step formGroupName="2" [stepControl]="getFormObject(formElement)?.get([2])">
              <ng-template matStepLabel>
                <span translate>mitigationAction.thematicCategorization</span>
              </ng-template>

              <span translate>mitigationAction.datatype</span><br /><br />
              <mat-radio-group #datatype="matRadioGroup" formControlName="datatypeCtrl" class="custom-radio-group">
                <mat-radio-button [style.margin.px]="5" [value]="1">
                  <label translate>Gestión</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" [value]="2">
                  <label translate>Resultadoso</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" [value]="3">
                  <label translate>general.other</label>
                </mat-radio-button>
              </mat-radio-group>
              <br />

              <div *ngIf="datatype.value === 3">
                <mat-form-field class="field-ppcn">
                  <mat-label translate>general.other</mat-label>
                  <input matInput formControlName="datatypeOtherCtrl" />
                  <mat-error translate>errorLabel.fieldRequired</mat-error>
                </mat-form-field>
                <br />
              </div>

              <span translate>mitigationAction.SINAMECCClassifiers</span><br /><br />
              <mat-radio-group
                #sinameccClassifiers="matRadioGroup"
                formControlName="sinameccClassifiersCtrl"
                class="custom-radio-group"
              >
                <mat-radio-button [style.margin.px]="5" [value]="1">
                  <label translate>Acción Climática</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" [value]="2">
                  <label translate>Modelación</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" [value]="3">
                  <label translate>INGEI</label>
                </mat-radio-button>

                <mat-radio-button [style.margin.px]="5" [value]="4">
                  <label translate>Reportes</label>
                </mat-radio-button>

                <mat-radio-button [style.margin.px]="5" [value]="5">
                  <label translate>Finanzas Climaticas</label>
                </mat-radio-button>

                <mat-radio-button [style.margin.px]="5" [value]="6">
                  <label translate>Impactos</label>
                </mat-radio-button>

                <mat-radio-button [style.margin.px]="5" [value]="7">
                  <label translate>general.other</label>
                </mat-radio-button>
              </mat-radio-group>
              <br />

              <div *ngIf="sinameccClassifiers.value === 7">
                <mat-form-field class="field-ppcn">
                  <mat-label translate>general.other</mat-label>
                  <input matInput formControlName="sinameccClassifiersOtherCtrl" />
                  <mat-error translate>errorLabel.fieldRequired</mat-error>
                </mat-form-field>
                <br />
              </div>

              <div class="box-button">
                <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
                </app-generic-button-secondary>
                <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
              </div>
            </mat-step>

            <mat-step formGroupName="3" [stepControl]="getFormObject(formElement)?.get([3])">
              <ng-template matStepLabel>
                <span translate>mitigationAction.contactInformation</span>
              </ng-template>

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.namePersonResponsible</mat-label>
                <input matInput formControlName="namePersonResponsibleCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <mat-form-field class="field-ppcn">
                <mat-label translate>reportData.institution</mat-label>
                <input matInput formControlName="institutionCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.contactPersonTitle</mat-label>
                <input matInput formControlName="contactPersonTitleCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <mat-form-field class="field-ppcn">
                <mat-label translate>info.emailAddress</mat-label>
                <input matInput formControlName="emailAddressCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <mat-form-field class="field-ppcn">
                <mat-label translate>info.phone</mat-label>
                <input matInput formControlName="phoneCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <div class="box-button">
                <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
                </app-generic-button-secondary>
                <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
              </div>
            </mat-step>

            <mat-step formGroupName="4" [stepControl]="getFormObject(formElement)?.get([4])">
              <ng-template matStepLabel>
                <span translate>mitigationAction.changeLog</span>
              </ng-template>

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.dateLastUpdate</mat-label>
                <input
                  matInput
                  [placeholder]="'Choose a date' | translate"
                  [matDatepicker]="dateLastUpdateDate"
                  formControlName="dateLastUpdateCtrl"
                />

                <mat-datepicker-toggle matSuffix [for]="dateLastUpdateDate"></mat-datepicker-toggle>
                <mat-datepicker #dateLastUpdateDate startView="year" [startAt]="startDate"></mat-datepicker>

                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.changesLastupdate</mat-label>
                <input matInput formControlName="changesLastupdateCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.descriptionChanges</mat-label>
                <input matInput formControlName="descriptionChangesCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <mat-form-field class="field-ppcn">
                <mat-label translate>mitigationAction.authorLastUpdate</mat-label>
                <input matInput formControlName="authorLastUpdateCtrl" />
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <div class="box-button">
                <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
                </app-generic-button-secondary>
                <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
              </div>
            </mat-step>

            <mat-step>
              <ng-template matStepLabel> <span translate> specificLabel.confirmInformation </span></ng-template>

              <div *ngIf="form.valid; else elseBlock" translate>specificLabel.everythingCorrect</div>

              <ng-template #elseBlock translate>Check the form for any errors marked in red</ng-template>

              <div class="align-right" *ngIf="i === getFormKeys().length - 1">
                <app-generic-button type="submit" [disabled]="wasSubmittedSuccessfully" name="general.done">
                </app-generic-button>
              </div>
            </mat-step>
          </mat-vertical-stepper>
          <div>
            <button mat-mini-fab color="warn" *ngIf="i > 0" (click)="removeForm(formElement)" type="button">
              <mat-icon>delete forever</mat-icon>
            </button>
          </div>
        </div>

        <div class="align-right">
          <button mat-mini-fab (click)="addNewForm()" type="button">
            <mat-icon>add</mat-icon>
          </button>
        </div>
      </div>
    </form>
  </mat-card-content>
</div>
