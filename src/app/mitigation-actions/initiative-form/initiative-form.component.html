<div class="container">
  <div class="header-container" fxLayout="column" fxLayoutAlign="center center">
    <h2 translate>specificLabel.registerInitiatives</h2>
  </div>
  <mat-card-content>
    <form *ngIf="newFormData | async" [formGroup]="form" (ngSubmit)="submitForm()">
      <div class="report-error" [hidden]="!error || isLoading || !errorComponent.showErrors" translate>
        <span translate>errorLabel.errorSubmittingForm</span>
        <app-error-reporting #errorComponent></app-error-reporting>
      </div>
      <br />
      <div fxLayout="column">
        <mat-vertical-stepper formArrayName="formArray" linear #stepper>
          <mat-step formGroupName="0" [stepControl]="formArray?.get([0])">
            <ng-template matStepLabel> <span>1.1 - </span><span translate>specificLabel.initiative</span> </ng-template>

            <h3 *ngIf="isUpdating">
              <span translate>info.code</span>:<span>{{ mitigationAction?.id }}</span>
            </h3>

            <div>
              <label class="radio-grup-label" translate
                >1.1.1 - <span translate>specificLabel.initiativeType</span></label
              >
              <mat-radio-group class="custom-radio-group" formControlName="initiativeTypeCtrl">
                <mat-radio-button
                  [style.margin.px]="5"
                  *ngFor="let initiativeType of processedNewFormData?.initiative_type"
                  [value]="initiativeType.id"
                >
                  {{ initiativeType.name }}
                </mat-radio-button>
              </mat-radio-group>
            </div>

            <mat-form-field class="field-ppcn">
              <mat-label translate>1.1.2 - <span translate>specificLabel.initiativeName</span></mat-label>
              <input matInput formControlName="initiativeNameCtrl" />
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <mat-form-field class="field-ppcn">
              <mat-label translate>1.1.3 - <span translate>specificLabel.initiativeObjective</span></mat-label>
              <textarea
                matInput
                formControlName="initiativeObjectiveCtrl"
                matTextareaAutosize
                maxlength="100"
                matAutosizeMinRows="2"
                matAutosizeMaxRows="20"
              ></textarea>
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <div fxLayout="row" fxLayoutAlign=" center">
              <mat-form-field class="field-ppcn">
                <mat-label translate>1.1.4 - <span translate>specificLabel.initiativeDescription</span></mat-label>
                <textarea
                  matInput
                  formControlName="initiativeDescriptionCtrl"
                  matTextareaAutosize
                  matAutosizeMinRows="2"
                  matAutosizeMaxRows="20"
                ></textarea>
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>
              <input type="file" name="filename" />
            </div>
            <div>
              <mat-form-field class="field-ppcn">
                <mat-label translate>1.1.5 - <span translate>specificLabel.initiativeGoal</span></mat-label>
                <input #goalInput matInput formControlName="initiativeGoalCtrl" />
                <button
                  [disabled]="goalInput.value == ''"
                  (click)="initiativeGoalList.push(goalInput.value); goalInput.value = ''"
                  type="button"
                  mat-button
                  matSuffix
                  mat-icon-button
                >
                  <mat-icon>add_circle_outline</mat-icon>
                </button>
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>

              <div *ngIf="initiativeGoalList.length > 0">
                <mat-chip-list>
                  <mat-chip
                    (removed)="removeGoal(item)"
                    *ngFor="let item of initiativeGoalList"
                    selected
                    color="primary"
                  >
                    {{ item }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                  </mat-chip>
                </mat-chip-list>
              </div>
            </div>
            <br />
            <!-- <div class="margin-20">
              <div>step details:-</div>
              <pre>Is formArray?.get([0]) valid?: <br />{{formArray?.get([0]).valid | json}}</pre>
              <pre>formArray?.get([0]) value: <br />{{formArray?.get([0]).value | json}}</pre>
              <pre>formArray?.get([0]) : <br />{{formArray?.get([0]) | json }}</pre>
              <pre>first step valid? : <br />{{formArray?.get([0]).valid | json}}</pre>

            </div> -->
            <div class="box-button">
              <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
            </div>
          </mat-step>

          <mat-step formGroupName="1" [stepControl]="formArray?.get([1])">
            <ng-template matStepLabel>
              <span>1.2 - </span><span translate>specificLabel.initiativeContactInfo</span>
            </ng-template>
            <mat-form-field class="field-ppcn">
              <mat-label translate>1.2.1 - <span translate>mitigationAction.entityReporting</span></mat-label>
              <input maxlength="50" matInput formControlName="entityReportingCtrl" />
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>
            <br />
            <mat-form-field class="field-ppcn">
              <mat-label translate>1.2.2 - <span translate>info.contactName</span></mat-label>
              <input maxlength="40" matInput formControlName="initiativeContactNameCtrl" />
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>
            <br />
            <mat-form-field class="field-ppcn">
              <mat-label translate>1.2.3 - <span translate>general.position</span></mat-label>
              <input maxlength="100" matInput formControlName="initiativePositionCtrl" />
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>
            <br />

            <mat-form-field class="field-ppcn">
              <mat-label translate>1.2.4 - <span translate>info.emailAddress</span></mat-label>
              <input type="email" matInput formControlName="initiativeEmailFormCtrl" />
              <mat-error translate>errorLabel.formatyInvalid</mat-error>
            </mat-form-field>
            <br />

            <mat-form-field class="field-ppcn">
              <mat-label translate>1.2.5 - <span translate>info.phone</span></mat-label>
              <span matPrefix>+506 &nbsp;</span>
              <input matInput formControlName="initiativePhoneCtrl" type="tel" maxlength="8" />
              <mat-error translate>errorLabel.inputOrLengthIncorrect</mat-error>
            </mat-form-field>
            <br />
            <div class="box-button">
              <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
              </app-generic-button-secondary>
              <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
            </div>
          </mat-step>

          <mat-step formGroupName="2" [stepControl]="formArray?.get([2])">
            <ng-template matStepLabel>
              <span>1.3 - </span><span translate>mitigationAction.statusMitigationAction</span>
            </ng-template>
            <br />

            <div>
              <label class="radio-grup-label" translate
                >1.3.1 - <span translate>mitigationAction.initiativeStatus</span></label
              >
              <mat-radio-group class="custom-radio-group" formControlName="initiativeStatusCtrl">
                <mat-radio-button
                  [style.margin.px]="5"
                  *ngFor="let element of processedNewFormData?.status"
                  [value]="element.id"
                >
                  {{ element.status }}
                </mat-radio-button>
              </mat-radio-group>
            </div>

            <br />

            <mat-form-field class="field-ppcn">
              <mat-label translate>1.3.2 - <span translate>mitigationAction.startImplementation</span></mat-label>
              <input
                matInput
                [placeholder]="'Choose a date' | translate"
                [matDatepicker]="implementationEmissionDatePicker"
                formControlName="startImplementationCtrl"
              />

              <mat-datepicker-toggle matSuffix [for]="implementationEmissionDatePicker"></mat-datepicker-toggle>
              <mat-datepicker #implementationEmissionDatePicker startView="year" [startAt]="startDate"></mat-datepicker>

              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <div>
              <label class="radio-grup-label" translate
                >1.3.3 - <span translate>mitigationAction.deploymentCompletion</span></label
              >

              <mat-radio-group
                formControlName="deploymentCompletionIdCtrl"
                #deploymentCompletionOption="matRadioGroup"
                class="custom-radio-group"
              >
                <mat-radio-button [style.margin.px]="5" value="1">
                  <label translate>general.estimatedDate</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="2">
                  <label translate>general.other</label>
                </mat-radio-button>
              </mat-radio-group>
            </div>

            <mat-form-field *ngIf="deploymentCompletionOption.value == '1'" class="field-ppcn">
              <mat-label translate>1.3.3 - <span translate>general.estimatedDate</span></mat-label>
              <input
                matInput
                formControlName="deploymentCompletionDateCtrl"
                [placeholder]="'Choose a date' | translate"
                [matDatepicker]="implementationEmissionDatePickerEstimateDate"
              />

              <mat-datepicker-toggle matSuffix [for]="implementationEmissionDatePickerEstimateDate">
              </mat-datepicker-toggle>
              <mat-datepicker #implementationEmissionDatePickerEstimateDate startView="year" [startAt]="startDate">
              </mat-datepicker>

              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <mat-form-field *ngIf="deploymentCompletionOption.value == '2'" class="field-ppcn">
              <mat-label translate>1.3.3 - <span translate>general.other</span></mat-label>
              <input formControlName="deploymentCompletionOtherCtrl" matInput />
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <br />

            <mat-form-field class="field-ppcn">
              <mat-label translate
                >1.3.4 - <label translate>mitigationAction.entityResponsibleMitigationAction</label>
                <mat-icon [matTooltip]="'general.maxWords' | translate">info</mat-icon>
              </mat-label>
              <textarea
                matInput
                formControlName="entityResponsibleMitigationActionCtrl"
                matTextareaAutosize
                matAutosizeMinRows="2"
                matAutosizeMaxRows="20"
              ></textarea>
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <mat-form-field class="field-ppcn">
              <mat-label
                >1.3.5 - <label translate>mitigationAction.entitiesInvolvedMitigationActionCtrl</label>
                <mat-icon>info</mat-icon>
              </mat-label>

              <textarea
                matInput
                formControlName="entitiesInvolvedMitigationActionCtrl"
                matTextareaAutosize
                matAutosizeMinRows="2"
                matAutosizeMaxRows="20"
              ></textarea>
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <br />

            <div class="box-button">
              <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
              </app-generic-button-secondary>
              <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
            </div>
          </mat-step>

          <mat-step formGroupName="3" [stepControl]="formArray?.get([3])">
            <ng-template matStepLabel>
              <span>1.4 - </span><span translate>general.GeographicLocation</span>
            </ng-template>

            <div>
              <label class="radio-grup-label" translate>1.4.1 - <span translate>general.geographicScale</span></label>
              <mat-radio-group formControlName="geographicScaleCtrl" class="custom-radio-group">
                <mat-radio-button
                  [style.margin.px]="5"
                  *ngFor="let element of processedNewFormData?.geographic_scale"
                  [value]="element.id"
                >
                  {{ element.name }}
                </mat-radio-button>
              </mat-radio-group>
            </div>

            <div fxLayout="row" fxLayoutAlign=" center">
              <mat-form-field class="field-ppcn">
                <mat-label translate>1.4.2 - <span translate>general.locationAction</span></mat-label>
                <textarea
                  matInput
                  formControlName="locationActionCtrl"
                  matTextareaAutosize
                  matAutosizeMinRows="2"
                  matAutosizeMaxRows="20"
                ></textarea>
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>
              <input type="file" name="filename2" />
            </div>

            <div class="box-button">
              <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
              </app-generic-button-secondary>
              <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
            </div>
          </mat-step>

          <mat-step formGroupName="4" [stepControl]="formArray?.get([4])">
            <ng-template matStepLabel>
              <span>1.5 - </span><span translate>mitigationAction.CategorizationNationalInstruments</span>
              <mat-icon [matTooltip]="section5TooltipTxt">info</mat-icon>
            </ng-template>

            <mat-form-field class="field-ppcn last-section-mat-select" appearance="fill">
              <mat-label translate>1.5.1 - <span translate>mitigationAction.relationshipNDC</span></mat-label>
              <mat-select formControlName="relationshipNDCCtrl" (selectionChange)="loadSubNDCcatalogs($event.value)">
                <mat-option *ngFor="let element of processedNewFormData?.action_areas" [value]="element.id">
                  {{ element.name }}
                </mat-option>
              </mat-select>
              <mat-hint>Selecciones las áreas de acción de la NDC relacionadas con su acción de mitigación</mat-hint>
            </mat-form-field>
            <br />
            <mat-form-field *ngIf="ndcList.length > 0" class="field-ppcn last-section-mat-select" appearance="fill">
              <mat-label translate>1.5.1 - <span translate>mitigationAction.relationshipNDC</span></mat-label>
              <mat-select formControlName="relationshipNDCTopicCtrl" multiple>
                <mat-option *ngFor="let option of ndcList" [value]="option.code">
                  {{ option.area }}.{{ option.code }} - {{ option.goal }}
                </mat-option>
              </mat-select>
              <mat-hint translate>mitigationAction.relationshipNDCHint</mat-hint>
            </mat-form-field>
            <br />

            <mat-form-field class="field-ppcn last-section-mat-select" appearance="fill">
              <mat-label translate
                >1.5.2 - <span translate>mitigationAction.relationshipDecarbonizationPlan</span></mat-label
              >
              <mat-select
                formControlName="relationshipDecarbonizationPlanCtrl"
                (selectionChange)="loadSubDescarbonizatiocatalogs($event.value)"
              >
                <mat-option *ngFor="let element of processedNewFormData?.descarbonization_axis" [value]="element.id">
                  {{ element.description }}
                </mat-option>
              </mat-select>
              <mat-hint translate>mitigationAction.relationshipNDCHint</mat-hint>
            </mat-form-field>
            <br />

            <mat-form-field *ngIf="ejeList.length > 0" class="field-ppcn last-section-mat-select" appearance="fill">
              <mat-label translate
                >1.5.2 - <span translate>mitigationAction.relationshipDecarbonizationPlan</span></mat-label
              >
              <mat-select formControlName="relationshipDecarbonizationTopicPlanCtrl" multiple>
                <mat-option *ngFor="let option of ejeList" [value]="option.id">
                  VT - {{ option.axis }}.{{ option.code }} - {{ option.description }}
                </mat-option>
              </mat-select>
              <mat-hint translate>mitigationAction.relationshipNDCHint</mat-hint>
            </mat-form-field>

            <br />

            <div>
              <label class="radio-grup-label" translate
                >1.5.3 - <span translate>mitigationAction.impactCategory</span></label
              >
              <mat-radio-group formControlName="impactCategoryCtrl" class="custom-radio-group">
                <mat-radio-button [style.margin.px]="5" value="1">
                  <label translate>mitigationAction.directImpactGEI</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="2">
                  <label translate>mitigationAction.enablingMeasure</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="3">
                  <label translate>general.both</label>
                </mat-radio-button>
              </mat-radio-group>
            </div>

            <br />
            <br />

            <div>
              <label class="radio-grup-label" translate
                >1.5.4 -
                <span translate>¿La acción de mitigación que está registrando forma parte de otra?</span></label
              >
              <mat-radio-group
                formControlName="descriptionRelationshipMitigationActionOthersQuestionCtrl"
                #descriptionRelationshipMitigationActionOthers="matRadioGroup"
                class="custom-radio-group"
              >
                <mat-radio-button [style.margin.px]="5" value="1">
                  <label translate>general.yes</label>
                </mat-radio-button>
                <mat-radio-button [style.margin.px]="5" value="2">
                  No
                </mat-radio-button>
              </mat-radio-group>
            </div>

            <mat-form-field *ngIf="descriptionRelationshipMitigationActionOthers.value == '1'" class="field-ppcn">
              <mat-label translate
                >1.5.5.1 -
                <span translate>mitigationAction.descriptionRelationshipMitigationActionOthers</span></mat-label
              >
              <input formControlName="descriptionRelationshipMitigationActionOthersCtrl" type="tex" matInput />
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <div class="box-button">
              <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
              </app-generic-button-secondary>
              <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
            </div>
          </mat-step>

          <mat-step>
            <ng-template matStepLabel> <span translate> specificLabel.confirmInformation </span></ng-template>

            <div *ngIf="form.valid; else elseBlock" translate>specificLabel.everythingCorrect</div>

            <ng-template #elseBlock translate>Check the form for any errors marked in red</ng-template>
            <div class="align-right">
              <app-generic-button type="submit" [disabled]="wasSubmittedSuccessfully" name="general.done">
              </app-generic-button>
            </div>
          </mat-step>
        </mat-vertical-stepper>

        <!-- <div class="margin-20">
            <div>form details:-</div>
            <pre>Is myForm valid?: <br />{{form.valid | json}}</pre>
            <pre>form value: <br />{{form.value | json}}</pre>
            <pre>formArray?.get([0]) : <br />{{formArray?.get([0]) | json }}</pre>
            <pre>first step valid? : <br />{{formArray?.get([0]).valid | json}}</pre>

          </div> -->
      </div>
    </form>
  </mat-card-content>
</div>
