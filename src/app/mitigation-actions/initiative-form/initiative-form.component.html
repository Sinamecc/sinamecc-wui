<div class="container">
  <mat-card-content>
    <form *ngIf="newFormData | async" [formGroup]="form" (ngSubmit)="submitForm()">
      <div class="report-error" [hidden]="!error || isLoading || !errorComponent.showErrors" translate>
        <span translate>errorLabel.errorSubmittingForm</span>
        <br />
        <app-error-reporting #errorComponent></app-error-reporting>
      </div>
      <br />
      <div fxLayout="column">
        <mat-vertical-stepper formArrayName="formArray" linear #stepper>
          <mat-step formGroupName="0" [stepControl]="formArray?.get([0])">
            <ng-template matStepLabel>
              <span translate>specificLabel.initiative</span>
            </ng-template>

            <h3 *ngIf="isUpdating">
              <span translate>info.code</span>:<span>{{ mitigationAction?.id }}</span>
            </h3>
            <br />

            <span translate>specificLabel.initiativeType</span><br /><br />
            <mat-radio-group class="custom-radio-group" formControlName="initiativeTypeCtrl">
              <mat-radio-button [style.margin.px]="5" *ngFor="let initiativeType of processedNewFormData?.initiative_type"
                [value]="initiativeType.id">
                {{ initiativeType.name }}
              </mat-radio-button>
            </mat-radio-group>

            <br />
            <br />
            <mat-form-field class="field-ppcn">
              <mat-label translate>specificLabel.initiativeName</mat-label>
              <input matInput formControlName="initiativeNameCtrl" />
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>
            
            <br />
            <mat-form-field class="field-ppcn">
              <textarea matInput formControlName="initiativeObjectiveCtrl"
                [placeholder]="'specificLabel.initiativeObjective' | translate" matTextareaAutosize
                matAutosizeMinRows="2" matAutosizeMaxRows="20"></textarea>
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>
            <br />

            <div fxLayout="row" fxLayoutAlign=" center">
            <input type="file" accept=".rar,application/pdf,.zip" name="filename" />
            <mat-form-field class="field-ppcn">
              <textarea matInput formControlName="initiativeDescriptionCtrl"
                [placeholder]="'specificLabel.initiativeDescription' | translate" matTextareaAutosize
                matAutosizeMinRows="2" matAutosizeMaxRows="20"></textarea>
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>
            <br />
            </div>
            <div>
            <mat-form-field class="field-ppcn">
              <input #goalInput matInput formControlName="initiativeGoalCtrl"
                [placeholder]="'specificLabel.initiativeGoal' | translate"  />
                <button [disabled]="goalInput.value == ''" (click)="initiativeGoalList.push(goalInput.value);goalInput.value=''" type="button" mat-button matSuffix mat-icon-button>
                  <mat-icon>add_circle_outline</mat-icon>
                </button>
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <div *ngIf="initiativeGoalList.length > 0">
              <mat-chip-list>
                <mat-chip (removed)="removeGoal(item)" *ngFor="let item of initiativeGoalList" selected color="primary">
                  {{item}}
                  <mat-icon matChipRemove >cancel</mat-icon>
                </mat-chip>
              </mat-chip-list>
            </div>
            
            </div>
            <br />
            <!-- <div class="margin-20">
              <div>step details:-</div>
              <pre>Is formArray?.get([0]) valid?: <br />{{formArray?.get([0]).valid | json}}</pre>
              <pre>formArray?.get([0]) value: <br />{{formArray?.get([0]).value | json}}</pre>
              <pre>formArray?.get([0]) : <br />{{formArray?.get([0]) | json }}</pre>
              <pre>first step valid? : <br />{{formArray?.get([0]).valid | json}}</pre>
  
            </div> -->
            <div class="box-button">
              <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
            </div>
          </mat-step>

          <mat-step formGroupName="1" [stepControl]="formArray?.get([1])">
            <ng-template matStepLabel>
              <span translate>specificLabel.initiativeContactInfo</span>
            </ng-template>
             <mat-form-field class="field-ppcn">
              <mat-label translate>mitigationAction.entityReporting</mat-label>
              <input matInput formControlName="entityReportingCtrl" />
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>
            <br />
            <mat-form-field class="field-ppcn">
              <mat-label translate>info.contactName</mat-label>
              <input matInput formControlName="initiativeContactNameCtrl" />
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>
            <br />
            <mat-form-field class="field-ppcn">
              <mat-label translate>general.position</mat-label>
              <input matInput formControlName="initiativePositionCtrl" />
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>
            <br />

            <mat-form-field class="field-ppcn">
              <mat-label translate>info.emailAddress</mat-label>
              <input type="email" matInput formControlName="initiativeEmailFormCtrl" />
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>
            <br />

            <mat-form-field class="field-ppcn">
              <mat-label translate>info.phone</mat-label>
              <span matPrefix>+506 &nbsp;</span>
              <input matInput formControlName="initiativePhoneCtrl" type="tel" maxlength="8" />
              <mat-error translate>errorLabel.inputOrLengthIncorrect</mat-error>
            </mat-form-field>
            <br />
            <div class="box-button">
              <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
              </app-generic-button-secondary>
              <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
            </div>
          </mat-step>

          <mat-step formGroupName="2" [stepControl]="formArray?.get([2])">
            <ng-template matStepLabel>
              <span translate>mitigationAction.statusMitigationAction</span>
            </ng-template>
            <br />

            <span translate>mitigationAction.initiativeStatus</span><br /><br />
            <mat-radio-group class="custom-radio-group" formControlName="initiativeStatusCtrl">
              <mat-radio-button [style.margin.px]="5"
                *ngFor="let element of processedNewFormData?.status"
                [value]="element.id"
              >
                {{element.status}}
              </mat-radio-button>
            </mat-radio-group>

            <br />

            <mat-form-field class="field-ppcn">
              <mat-label translate>mitigationAction.startImplementation</mat-label>
              <input matInput
              [placeholder]="'Choose a date' | translate"
              [matDatepicker]="implementationEmissionDatePicker"
              formControlName="startImplementationCtrl" />

              <mat-datepicker-toggle matSuffix [for]="implementationEmissionDatePicker"></mat-datepicker-toggle>
              <mat-datepicker #implementationEmissionDatePicker startView="year" [startAt]="startDate"></mat-datepicker>

              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

             <br />

             <span translate>mitigationAction.deploymentCompletion</span><br /><br />
            <mat-radio-group formControlName="deploymentCompletionIdCtrl"  #deploymentCompletionOption="matRadioGroup"  class="custom-radio-group" >
              <mat-radio-button [style.margin.px]="5"
                value="1">
                <label translate>general.estimatedDate</label> 
              </mat-radio-button>
              <mat-radio-button [style.margin.px]="5"
                value="2">
                <label translate>general.other</label>
              </mat-radio-button>
            </mat-radio-group>

            <br />

            <mat-form-field *ngIf="deploymentCompletionOption.value == '1'" class="field-ppcn">
              <mat-label translate><label translate>general.estimatedDate</label> </mat-label>
              <input matInput
              formControlName="deploymentCompletionDateCtrl"
              [placeholder]="'Choose a date' | translate"
              [matDatepicker]="implementationEmissionDatePickerEstimateDate"
               />

              <mat-datepicker-toggle matSuffix [for]="implementationEmissionDatePickerEstimateDate"></mat-datepicker-toggle>
              <mat-datepicker #implementationEmissionDatePickerEstimateDate startView="year" [startAt]="startDate"></mat-datepicker>

              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <br />

            <mat-form-field *ngIf="deploymentCompletionOption.value == '2'" class="field-ppcn">
              <mat-label translate><label translate>general.other</label> </mat-label>
              <input formControlName="deploymentCompletionOtherCtrl"  matInput  />
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <br />

            <mat-form-field class="field-ppcn">
               <mat-label translate><label translate>mitigationAction.entitiesInvolvedMitigationActionCtrl</label>
                <mat-icon [matTooltip]="('general.maxWords' | translate)">info</mat-icon></mat-label>
               <textarea matInput formControlName="entityResponsibleMitigationActionCtrl"
                matTextareaAutosize
                matAutosizeMinRows="2" matAutosizeMaxRows="20"></textarea>
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <mat-form-field class="field-ppcn">
              <mat-label ><label translate>mitigationAction.entitiesInvolvedMitigationActionCtrl</label>
                <mat-icon >info</mat-icon></mat-label>
               
               <textarea matInput formControlName="entitiesInvolvedMitigationActionCtrl"
                 matTextareaAutosize
                matAutosizeMinRows="2" matAutosizeMaxRows="20"></textarea>
              <mat-error translate>errorLabel.fieldRequired</mat-error>
            </mat-form-field>

            <br />

            <div class="box-button">
              <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
              </app-generic-button-secondary>
              <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
            </div>

            
          </mat-step>

          <mat-step formGroupName="3" [stepControl]="formArray?.get([3])">
            <ng-template matStepLabel>
              <span translate>general.GeographicLocation</span>
            </ng-template>
            <br />

            <span translate>general.geographicScale</span><br /><br />
            <mat-radio-group formControlName="geographicScaleCtrl" class="custom-radio-group" >
              <mat-radio-button [style.margin.px]="5"
                *ngFor="let element of processedNewFormData?.geographic_scale"
                [value]="element.id"
              >
                {{element.name}}
              </mat-radio-button>
            </mat-radio-group>

             <br />

            <div fxLayout="row" fxLayoutAlign=" center">
              <input type="file" accept=".rar,application/pdf,.zip" name="filename2" />
              <mat-form-field class="field-ppcn">
                <textarea matInput formControlName="locationActionCtrl"
                  [placeholder]="'general.locationAction' | translate" matTextareaAutosize
                  matAutosizeMinRows="2" matAutosizeMaxRows="20"></textarea>
                <mat-error translate>errorLabel.fieldRequired</mat-error>
              </mat-form-field>
              <br />
            </div>

             <br />

             <div class="box-button">
              <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
              </app-generic-button-secondary>
              <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
            </div>

          </mat-step>

          <mat-step formGroupName="4" [stepControl]="formArray?.get([4])">

            <ng-template matStepLabel>
              <span translate>mitigationAction.CategorizationNationalInstruments</span>
            </ng-template>
            <br />

    
            <mat-form-field class="field-ppcn" appearance="fill">
              <mat-label translate>mitigationAction.relationshipNDC</mat-label>
              <mat-select multiple>
                <mat-optgroup *ngFor="let ndcItem of ndcList" [label]="ndcItem.name"
                              >
                  <mat-option *ngFor="let option of ndcItem.options" [value]="option.code">
                    {{option.code}} - {{option.name}}
                  </mat-option>
                </mat-optgroup>
              </mat-select>
            </mat-form-field>

            <br />
            <br />

            <mat-form-field class="field-ppcn" appearance="fill">
              <mat-label translate>mitigationAction.relationshipDecarbonizationPlan</mat-label>
              <mat-select multiple>
                <mat-optgroup *ngFor="let eje of ejeList" [label]="eje.name"
                              >
                  <mat-option *ngFor="let option of eje.options" [value]="option.code">
                    VT - {{option.code}} - {{option.name}}
                  </mat-option>
                </mat-optgroup>
              </mat-select>
            </mat-form-field>

            <br />
            <br />

            <mat-form-field class="field-ppcn" appearance="fill">
              <mat-label translate>mitigationAction.relationshipDecarbonizationPlan</mat-label>
              <mat-select multiple>
                <mat-optgroup *ngFor="let topic of temasList" [label]="topic.name"
                              >
                  <mat-option *ngFor="let option of topic.options" [value]="option.name">
                   {{option.name}}
                  </mat-option>
                </mat-optgroup>
              </mat-select>
            </mat-form-field>

            <br />
            <br />


           <span translate>mitigationAction.impactCategory</span><br /><br />
            <mat-radio-group  class="custom-radio-group">
              <mat-radio-button [style.margin.px]="5"
                value="1">
                <label translate>mitigationAction.directImpactGEI</label>
              </mat-radio-button>
              <mat-radio-button [style.margin.px]="5"
                value="2">
                <label translate>mitigationAction.enablingMeasure</label>
              </mat-radio-button>
              <mat-radio-button [style.margin.px]="5"
                value="3">
                <label translate>general.both</label>
              </mat-radio-button>
            </mat-radio-group>

             <br />
            <br />


           <span translate>¿La acción de mitigación que está registrando forma parte de otra?</span><br /><br />
            <mat-radio-group class="custom-radio-group" >
              <mat-radio-button [style.margin.px]="5"
                value="1">
                <label translate>general.yes</label>
              </mat-radio-button>
              <mat-radio-button [style.margin.px]="5"
                value="2">
                No
              </mat-radio-button>
            </mat-radio-group>
            

            <div class="box-button">
              <app-generic-button-secondary type="button" (click)="stepper.previous()" name="general.back">
              </app-generic-button-secondary>
              <app-generic-button (click)="stepper.next()" name="general.next"></app-generic-button>
            </div>

          </mat-step>

          <mat-step>
            <ng-template matStepLabel> <span translate> specificLabel.confirmInformation </span></ng-template>

            <div *ngIf="form.valid; else elseBlock" translate>specificLabel.everythingCorrect</div>

            <ng-template #elseBlock translate>Check the form for any errors marked in red</ng-template>
            <div class="align-right">
              <app-generic-button type="submit" [disabled]="wasSubmittedSuccessfully" name="general.done">
              </app-generic-button>
            </div>
          </mat-step>
        </mat-vertical-stepper>


        <!-- <div class="margin-20">
            <div>form details:-</div>
            <pre>Is myForm valid?: <br />{{form.valid | json}}</pre>
            <pre>form value: <br />{{form.value | json}}</pre>
            <pre>formArray?.get([0]) : <br />{{formArray?.get([0]) | json }}</pre>
            <pre>first step valid? : <br />{{formArray?.get([0]).valid | json}}</pre>

          </div> -->
      </div>
    </form>
  </mat-card-content>
</div>
